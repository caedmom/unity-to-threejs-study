window.Physijs=function(){"use strict";var t,e=!1,i=s,s={},o,n,r,h,a,p,c,d,y=new THREE.Vector3,u=new THREE.Vector3,l=new THREE.Matrix4,_=new THREE.Quaternion,x={WORLDREPORT:0,COLLISIONREPORT:1,VEHICLEREPORT:2,CONSTRAINTREPORT:3},f=14,b=5,m=9,j=6;return s.scripts={},o=function(){this._eventListeners={}},o.prototype.addEventListener=function(t,e){this._eventListeners.hasOwnProperty(t)||(this._eventListeners[t]=[]),this._eventListeners[t].push(e)},o.prototype.removeEventListener=function(t,e){var i;return this._eventListeners.hasOwnProperty(t)&&(i=this._eventListeners[t].indexOf(e))>=0?(this._eventListeners[t].splice(i,1),!0):!1},o.prototype.dispatchEvent=function(t){var e,i=Array.prototype.splice.call(arguments,1);if(this._eventListeners.hasOwnProperty(t))for(e=0;e<this._eventListeners[t].length;e++)this._eventListeners[t][e].apply(this,i)},o.make=function(t){t.prototype.addEventListener=o.prototype.addEventListener,t.prototype.removeEventListener=o.prototype.removeEventListener,t.prototype.dispatchEvent=o.prototype.dispatchEvent},n=function(){var t=1;return function(){return t++}}(),r=function(t,e,i,s){return new THREE.Vector3(Math.atan2(2*(t*s-e*i),s*s-t*t-e*e+i*i),Math.asin(2*(t*i+e*s)),Math.atan2(2*(i*s-t*e),s*s+t*t-e*e-i*i))},h=function(t,e,i){var s,o,n,r,h,a,p,c;return s=Math.cos(e),o=Math.sin(e),n=Math.cos(-i),r=Math.sin(-i),h=Math.cos(t),a=Math.sin(t),p=s*n,c=o*r,{w:p*h-c*a,x:p*a+c*h,y:o*n*h+s*r*a,z:s*r*h-o*n*a}},a=function(t,e){return l.identity(),l.identity().makeRotationFromQuaternion(e.quaternion),l.getInverse(l),y.copy(t),u.copy(e.position),y.sub(u).applyMatrix4(l)},s.noConflict=function(){return window.Physijs=i,s},s.createMaterial=function(t,e,i){var s=function(){};return s.prototype=t,s=new s,s._physijs={id:t.id,friction:void 0===e?.8:e,restitution:void 0===i?.2:i},s},s.PointConstraint=function(t,e,i){void 0===i&&(i=e,e=void 0),this.type="point",this.appliedImpulse=0,this.id=n(),this.objecta=t._physijs.id,this.positiona=a(i,t).clone(),e&&(this.objectb=e._physijs.id,this.positionb=a(i,e).clone())},s.PointConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb}},s.HingeConstraint=function(t,e,i,s){void 0===s&&(s=i,i=e,e=void 0),this.type="hinge",this.appliedImpulse=0,this.id=n(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=a(i,t).clone(),this.position=i.clone(),this.axis=s,e&&(this.objectb=e._physijs.id,this.positionb=a(i,e).clone())},s.HingeConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},s.HingeConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("hinge_setLimits",{constraint:this.id,low:t,high:e,bias_factor:i,relaxation_factor:s})},s.HingeConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("hinge_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},s.HingeConstraint.prototype.disableMotor=function(t,e){this.scene.execute("hinge_disableMotor",{constraint:this.id})},s.SliderConstraint=function(t,e,i,s){void 0===s&&(s=i,i=e,e=void 0),this.type="slider",this.appliedImpulse=0,this.id=n(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=a(i,t).clone(),this.axis=s,e&&(this.objectb=e._physijs.id,this.positionb=a(i,e).clone())},s.SliderConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axis:this.axis}},s.SliderConstraint.prototype.setLimits=function(t,e,i,s){this.scene.execute("slider_setLimits",{constraint:this.id,lin_lower:t,lin_upper:e,ang_lower:i,ang_upper:s})},s.SliderConstraint.prototype.setRestitution=function(t,e){this.scene.execute("slider_setRestitution",{constraint:this.id,linear:t,angular:e})},s.SliderConstraint.prototype.enableLinearMotor=function(t,e){this.scene.execute("slider_enableLinearMotor",{constraint:this.id,velocity:t,acceleration:e})},s.SliderConstraint.prototype.disableLinearMotor=function(){this.scene.execute("slider_disableLinearMotor",{constraint:this.id})},s.SliderConstraint.prototype.enableAngularMotor=function(t,e){this.scene.execute("slider_enableAngularMotor",{constraint:this.id,velocity:t,acceleration:e})},s.SliderConstraint.prototype.disableAngularMotor=function(){this.scene.execute("slider_disableAngularMotor",{constraint:this.id})},s.ConeTwistConstraint=function(t,e,i){if(void 0===i)throw"Both objects must be defined in a ConeTwistConstraint.";this.type="conetwist",this.appliedImpulse=0,this.id=n(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=a(i,t).clone(),this.objectb=e._physijs.id,this.positionb=a(i,e).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z}},s.ConeTwistConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},s.ConeTwistConstraint.prototype.setLimit=function(t,e,i){this.scene.execute("conetwist_setLimit",{constraint:this.id,x:t,y:e,z:i})},s.ConeTwistConstraint.prototype.enableMotor=function(){this.scene.execute("conetwist_enableMotor",{constraint:this.id})},s.ConeTwistConstraint.prototype.setMaxMotorImpulse=function(t){this.scene.execute("conetwist_setMaxMotorImpulse",{constraint:this.id,max_impulse:t})},s.ConeTwistConstraint.prototype.setMotorTarget=function(t){t instanceof THREE.Vector3?t=(new THREE.Quaternion).setFromEuler(new THREE.Euler(t.x,t.y,t.z)):t instanceof THREE.Euler?t=(new THREE.Quaternion).setFromEuler(t):t instanceof THREE.Matrix4&&(t=(new THREE.Quaternion).setFromRotationMatrix(t)),this.scene.execute("conetwist_setMotorTarget",{constraint:this.id,x:t.x,y:t.y,z:t.z,w:t.w})},s.ConeTwistConstraint.prototype.disableMotor=function(){this.scene.execute("conetwist_disableMotor",{constraint:this.id})},s.DOFConstraint=function(t,e,i){void 0===i&&(i=e,e=void 0),this.type="dof",this.appliedImpulse=0,this.id=n(),this.scene=t.parent,this.objecta=t._physijs.id,this.positiona=a(i,t).clone(),this.axisa={x:t.rotation.x,y:t.rotation.y,z:t.rotation.z},e&&(this.objectb=e._physijs.id,this.positionb=a(i,e).clone(),this.axisb={x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},s.DOFConstraint.prototype.getDefinition=function(){return{type:this.type,id:this.id,objecta:this.objecta,objectb:this.objectb,positiona:this.positiona,positionb:this.positionb,axisa:this.axisa,axisb:this.axisb}},s.DOFConstraint.prototype.setLinearLowerLimit=function(t){this.scene.execute("dof_setLinearLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},s.DOFConstraint.prototype.setLinearUpperLimit=function(t){this.scene.execute("dof_setLinearUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},s.DOFConstraint.prototype.setAngularLowerLimit=function(t){this.scene.execute("dof_setAngularLowerLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},s.DOFConstraint.prototype.setAngularUpperLimit=function(t){this.scene.execute("dof_setAngularUpperLimit",{constraint:this.id,x:t.x,y:t.y,z:t.z})},s.DOFConstraint.prototype.enableAngularMotor=function(t){this.scene.execute("dof_enableAngularMotor",{constraint:this.id,which:t})},s.DOFConstraint.prototype.configureAngularMotor=function(t,e,i,s,o){this.scene.execute("dof_configureAngularMotor",{constraint:this.id,which:t,low_angle:e,high_angle:i,velocity:s,max_force:o})},s.DOFConstraint.prototype.disableAngularMotor=function(t){this.scene.execute("dof_disableAngularMotor",{constraint:this.id,which:t})},s.Scene=function(e){var i=this;o.call(this),THREE.Scene.call(this),this._worker=new Worker(s.scripts.worker||"assets/js/lib/physijs/physijs_worker.js"),this._worker.transferableMessage=this._worker.webkitPostMessage||this._worker.postMessage,this._materials_ref_counts={},this._objects={},this._vehicles={},this._constraints={};var n=new ArrayBuffer(1);this._worker.transferableMessage(n,[n]),t=0===n.byteLength,this._worker.onmessage=function(t){var e,s=t.data;if(s instanceof ArrayBuffer&&1!==s.byteLength&&(s=new Float32Array(s)),s instanceof Float32Array)switch(s[0]){case x.WORLDREPORT:i._updateScene(s);break;case x.COLLISIONREPORT:i._updateCollisions(s);break;case x.VEHICLEREPORT:i._updateVehicles(s);break;case x.CONSTRAINTREPORT:i._updateConstraints(s)}else if(s.cmd)switch(s.cmd){case"objectReady":e=s.params,i._objects[e]&&i._objects[e].dispatchEvent("ready");break;case"worldReady":i.dispatchEvent("ready");break;case"vehicle":window.test=s;break;default:console.debug("Received: "+s.cmd),console.dir(s.params)}else switch(s[0]){case x.WORLDREPORT:i._updateScene(s);break;case x.COLLISIONREPORT:i._updateCollisions(s);break;case x.VEHICLEREPORT:i._updateVehicles(s);break;case x.CONSTRAINTREPORT:i._updateConstraints(s)}},e=e||{},e.ammo=s.scripts.ammo||"ammo.js",e.fixedTimeStep=e.fixedTimeStep||1/60,e.rateLimit=e.rateLimit||!0,this.execute("init",e)},s.Scene.prototype=new THREE.Scene,s.Scene.prototype.constructor=s.Scene,o.make(s.Scene),s.Scene.prototype._updateScene=function(i){var s=i[1],o,n,r;for(n=0;s>n;n++)r=2+n*f,o=this._objects[i[r]],void 0!==o&&(o.__dirtyPosition===!1&&o.position.set(i[r+1],i[r+2],i[r+3]),o.__dirtyRotation===!1&&o.quaternion.set(i[r+4],i[r+5],i[r+6],i[r+7]),o._physijs.linearVelocity.set(i[r+8],i[r+9],i[r+10]),o._physijs.angularVelocity.set(i[r+11],i[r+12],i[r+13]));t&&this._worker.transferableMessage(i.buffer,[i.buffer]),e=!1,this.dispatchEvent("update")},s.Scene.prototype._updateVehicles=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/m;o++)n=1+o*m,i=this._vehicles[e[n]],void 0!==i&&(s=i.wheels[e[n+1]],s.position.set(e[n+2],e[n+3],e[n+4]),s.quaternion.set(e[n+5],e[n+6],e[n+7],e[n+8]));t&&this._worker.transferableMessage(e.buffer,[e.buffer])},s.Scene.prototype._updateConstraints=function(e){var i,s,o,n;for(o=0;o<(e.length-1)/j;o++)n=1+o*j,i=this._constraints[e[n]],s=this._objects[e[n+1]],void 0!==i&&void 0!==s&&(y.set(e[n+2],e[n+3],e[n+4]),l.extractRotation(s.matrix),y.applyMatrix4(l),i.positiona.addVectors(s.position,y),i.appliedImpulse=e[n+5]);t&&this._worker.transferableMessage(e.buffer,[e.buffer])},s.Scene.prototype._updateCollisions=function(e){var i,s,o,n,r,h,a,p={},u={};for(i=0;i<e[1];i++)o=2+i*b,n=e[o],r=e[o+1],u[n+"-"+r]=o+2,u[r+"-"+n]=-1*(o+2),p[n]||(p[n]=[]),p[n].push(r),p[r]||(p[r]=[]),p[r].push(n);for(h in this._objects)if(this._objects.hasOwnProperty(h))if(n=this._objects[h],p[h]){for(s=0;s<n._physijs.touches.length;s++)-1===p[h].indexOf(n._physijs.touches[s])&&n._physijs.touches.splice(s--,1);for(s=0;s<p[h].length;s++)if(a=p[h][s],r=this._objects[a],r&&-1===n._physijs.touches.indexOf(a)){n._physijs.touches.push(a),y.subVectors(n.getLinearVelocity(),r.getLinearVelocity()),c=y.clone(),y.subVectors(n.getAngularVelocity(),r.getAngularVelocity()),d=y.clone();var l=u[n._physijs.id+"-"+r._physijs.id];l>0?y.set(-e[l],-e[l+1],-e[l+2]):(l*=-1,y.set(e[l],e[l+1],e[l+2])),n.dispatchEvent("collision",r,c,d,y)}}else n._physijs.touches.length=0;this.collisions=p,t&&this._worker.transferableMessage(e.buffer,[e.buffer])},s.Scene.prototype.addConstraint=function(t,e){if(this._constraints[t.id]=t,this.execute("addConstraint",t.getDefinition()),e){var i;switch(t.type){case"point":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"hinge":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"slider":i=new THREE.Mesh(new THREE.BoxGeometry(10,1,1),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),i.rotation.set(t.axis.y,t.axis.x,t.axis.z),this._objects[t.objecta].add(i);break;case"conetwist":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i);break;case"dof":i=new THREE.Mesh(new THREE.SphereGeometry(1.5),new THREE.MeshNormalMaterial),i.position.copy(t.positiona),this._objects[t.objecta].add(i)}}return t},s.Scene.prototype.onSimulationResume=function(){this.execute("onSimulationResume",{})},s.Scene.prototype.removeConstraint=function(t){void 0!==this._constraints[t.id]&&(this.execute("removeConstraint",{id:t.id}),delete this._constraints[t.id])},s.Scene.prototype.execute=function(t,e){this._worker.postMessage({cmd:t,params:e})},p=function(t,e){var i;for(i=0;i<e.children.length;i++)e.children[i]._physijs&&(e.children[i].updateMatrix(),e.children[i].updateMatrixWorld(),y.setFromMatrixPosition(e.children[i].matrixWorld),_.setFromRotationMatrix(e.children[i].matrixWorld),e.children[i]._physijs.position_offset={x:y.x,y:y.y,z:y.z},e.children[i]._physijs.rotation={x:_.x,y:_.y,z:_.z,w:_.w},t._physijs.children.push(e.children[i]._physijs)),p(t,e.children[i])},s.Scene.prototype.add=function(t){if(THREE.Mesh.prototype.add.call(this,t),t._physijs)if(t.world=this,t instanceof s.Vehicle)this.add(t.mesh),this._vehicles[t._physijs.id]=t,this.execute("addVehicle",t._physijs);else{t.__dirtyPosition=!1,t.__dirtyRotation=!1,this._objects[t._physijs.id]=t,t.children.length&&(t._physijs.children=[],p(t,t)),t.material._physijs&&(this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)?this._materials_ref_counts[t.material._physijs.id]++:(this.execute("registerMaterial",t.material._physijs),t._physijs.materialId=t.material._physijs.id,this._materials_ref_counts[t.material._physijs.id]=1)),t._physijs.position={x:t.position.x,y:t.position.y,z:t.position.z},t._physijs.rotation={x:t.quaternion.x,y:t.quaternion.y,z:t.quaternion.z,w:t.quaternion.w};var e=new THREE.Vector3(1,1,1);t._physijs.width&&(t._physijs.width*=t.scale.x),t._physijs.height&&(t._physijs.height*=t.scale.y),t._physijs.depth&&(t._physijs.depth*=t.scale.z),this.execute("addObject",t._physijs)}},s.Scene.prototype.remove=function(t){if(t instanceof s.Vehicle){for(this.execute("removeVehicle",{id:t._physijs.id});t.wheels.length;)this.remove(t.wheels.pop());this.remove(t.mesh),delete this._vehicles[t._physijs.id]}else THREE.Mesh.prototype.remove.call(this,t),t._physijs&&(delete this._objects[t._physijs.id],this.execute("removeObject",{id:t._physijs.id}));t.material&&t.material._physijs&&this._materials_ref_counts.hasOwnProperty(t.material._physijs.id)&&(this._materials_ref_counts[t.material._physijs.id]--,0==this._materials_ref_counts[t.material._physijs.id]&&(this.execute("unRegisterMaterial",t.material._physijs),delete this._materials_ref_counts[t.material._physijs.id]))},s.Scene.prototype.setFixedTimeStep=function(t){t&&this.execute("setFixedTimeStep",t)},s.Scene.prototype.setGravity=function(t){t&&this.execute("setGravity",t)},s.Scene.prototype.simulate=function(t,i){var s,o,n;if(e)return!1;e=!0;for(s in this._objects)this._objects.hasOwnProperty(s)&&(o=this._objects[s],(o.__dirtyPosition||o.__dirtyRotation)&&(n={id:o._physijs.id},o.__dirtyPosition&&(n.pos={x:o.position.x,y:o.position.y,z:o.position.z},o.__dirtyPosition=!1),o.__dirtyRotation&&(n.quat={x:o.quaternion.x,y:o.quaternion.y,z:o.quaternion.z,w:o.quaternion.w},o.__dirtyRotation=!1),this.execute("updateTransform",n)));return this.execute("simulate",{timeStep:t,maxSubSteps:i}),!0},s.Mesh=function(t,e,i){var s;t&&(o.call(this),THREE.Mesh.call(this,t,e),t.boundingBox||t.computeBoundingBox(),this._physijs={type:null,id:n(),mass:i||0,touches:[],linearVelocity:new THREE.Vector3,angularVelocity:new THREE.Vector3})},s.Mesh.prototype=new THREE.Mesh,s.Mesh.prototype.constructor=s.Mesh,o.make(s.Mesh),s.Mesh.prototype.__defineGetter__("mass",function(){return this._physijs.mass}),s.Mesh.prototype.__defineSetter__("mass",function(t){this._physijs.mass=t,this.world&&this.world.execute("updateMass",{id:this._physijs.id,mass:t})}),s.Mesh.prototype.applyCentralImpulse=function(t){this.world&&this.world.execute("applyCentralImpulse",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.applyImpulse=function(t,e){this.world&&this.world.execute("applyImpulse",{id:this._physijs.id,impulse_x:t.x,impulse_y:t.y,impulse_z:t.z,x:e.x,y:e.y,z:e.z})},s.Mesh.prototype.applyCentralForce=function(t){this.world&&this.world.execute("applyCentralForce",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.applyForce=function(t,e){this.world&&this.world.execute("applyForce",{id:this._physijs.id,force_x:t.x,force_y:t.y,force_z:t.z,x:e.x,y:e.y,z:e.z})},s.Mesh.prototype.getAngularVelocity=function(){return this._physijs.angularVelocity},s.Mesh.prototype.setAngularVelocity=function(t){this.world&&this.world.execute("setAngularVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.getLinearVelocity=function(){return this._physijs.linearVelocity},s.Mesh.prototype.setLinearVelocity=function(t){this.world&&this.world.execute("setLinearVelocity",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.setAngularFactor=function(t){this.world&&this.world.execute("setAngularFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.setLinearFactor=function(t){this.world&&this.world.execute("setLinearFactor",{id:this._physijs.id,x:t.x,y:t.y,z:t.z})},s.Mesh.prototype.setDamping=function(t,e){this.world&&this.world.execute("setDamping",{id:this._physijs.id,linear:t,angular:e})},s.Mesh.prototype.setCcdMotionThreshold=function(t){this.world&&this.world.execute("setCcdMotionThreshold",{id:this._physijs.id,threshold:t})},s.Mesh.prototype.setCcdSweptSphereRadius=function(t){this.world&&this.world.execute("setCcdSweptSphereRadius",{id:this._physijs.id,radius:t})},s.PlaneMesh=function(t,e,i){var o,n;s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="plane",this._physijs.normal=t.faces[0].normal.clone(),this._physijs.mass="undefined"==typeof i?o*n:i},s.PlaneMesh.prototype=new s.Mesh,s.PlaneMesh.prototype.constructor=s.PlaneMesh,s.HeightfieldMesh=function(t,e,i,o,n){s.Mesh.call(this,t,e,i),this._physijs.type="heightfield",this._physijs.xsize=t.boundingBox.max.x-t.boundingBox.min.x,this._physijs.ysize=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.xpts="undefined"==typeof o?Math.sqrt(t.vertices.length):o+1,this._physijs.ypts="undefined"==typeof n?Math.sqrt(t.vertices.length):n+1,this._physijs.absMaxHeight=Math.max(t.boundingBox.max.z,Math.abs(t.boundingBox.min.z));for(var r=[],h,a,p=0;p<t.vertices.length;p++)h=p%this._physijs.xpts,a=Math.round(p/this._physijs.xpts-p%this._physijs.xpts/this._physijs.xpts),r[p]=t.vertices[h+(this._physijs.ypts-a-1)*this._physijs.ypts].z;this._physijs.points=r},s.HeightfieldMesh.prototype=new s.Mesh,s.HeightfieldMesh.prototype.constructor=s.HeightfieldMesh,s.BoxMesh=function(t,e,i){var o,n,r;s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="box",this._physijs.width=o,this._physijs.height=n,this._physijs.depth=r,this._physijs.mass="undefined"==typeof i?o*n*r:i},s.BoxMesh.prototype=new s.Mesh,s.BoxMesh.prototype.constructor=s.BoxMesh,s.SphereMesh=function(t,e,i){s.Mesh.call(this,t,e,i),t.boundingSphere||t.computeBoundingSphere(),this._physijs.type="sphere",this._physijs.radius=t.boundingSphere.radius,this._physijs.mass="undefined"==typeof i?4/3*Math.PI*Math.pow(this._physijs.radius,3):i},s.SphereMesh.prototype=new s.Mesh,s.SphereMesh.prototype.constructor=s.SphereMesh,s.CylinderMesh=function(t,e,i){var o,n,r;s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="cylinder",this._physijs.width=o,this._physijs.height=n,this._physijs.depth=r,this._physijs.mass="undefined"==typeof i?o*n*r:i},s.CylinderMesh.prototype=new s.Mesh,s.CylinderMesh.prototype.constructor=s.CylinderMesh,s.CapsuleMesh=function(t,e,i){var o,n,r;s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,r=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="capsule",this._physijs.radius=Math.max(o/2,r/2),this._physijs.height=n,this._physijs.mass="undefined"==typeof i?o*n*r:i},s.CapsuleMesh.prototype=new s.Mesh,s.CapsuleMesh.prototype.constructor=s.CapsuleMesh,s.ConeMesh=function(t,e,i){var o,n,r;s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=t.boundingBox.max.x-t.boundingBox.min.x,n=t.boundingBox.max.y-t.boundingBox.min.y,this._physijs.type="cone",this._physijs.radius=o/2,this._physijs.height=n,this._physijs.mass="undefined"==typeof i?o*n:i},s.ConeMesh.prototype=new s.Mesh,s.ConeMesh.prototype.constructor=s.ConeMesh,s.ConcaveMesh=function(t,e,i){var o,n,r,h,a,p,c=[];for(s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),a=t.vertices,o=0;o<t.faces.length;o++)p=t.faces[o],p instanceof THREE.Face3?c.push([{x:a[p.a].x,y:a[p.a].y,z:a[p.a].z},{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.c].x,y:a[p.c].y,z:a[p.c].z}]):p instanceof THREE.Face4&&(c.push([{x:a[p.a].x,y:a[p.a].y,z:a[p.a].z},{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.d].x,y:a[p.d].y,z:a[p.d].z}]),c.push([{x:a[p.b].x,y:a[p.b].y,z:a[p.b].z},{x:a[p.c].x,y:a[p.c].y,z:a[p.c].z},{x:a[p.d].x,y:a[p.d].y,z:a[p.d].z}]));n=t.boundingBox.max.x-t.boundingBox.min.x,r=t.boundingBox.max.y-t.boundingBox.min.y,h=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="concave",this._physijs.triangles=c,this._physijs.mass="undefined"==typeof i?n*r*h:i},s.ConcaveMesh.prototype=new s.Mesh,s.ConcaveMesh.prototype.constructor=s.ConcaveMesh,s.ConvexMesh=function(t,e,i){var o,n,r,h,a=[];for(s.Mesh.call(this,t,e,i),t.boundingBox||t.computeBoundingBox(),o=0;o<t.vertices.length;o++)a.push({x:t.vertices[o].x,y:t.vertices[o].y,z:t.vertices[o].z});n=t.boundingBox.max.x-t.boundingBox.min.x,r=t.boundingBox.max.y-t.boundingBox.min.y,h=t.boundingBox.max.z-t.boundingBox.min.z,this._physijs.type="convex",this._physijs.points=a,this._physijs.mass="undefined"==typeof i?n*r*h:i},s.ConvexMesh.prototype=new s.Mesh,s.ConvexMesh.prototype.constructor=s.ConvexMesh,s.Vehicle=function(t,e){e=e||new s.VehicleTuning,this.mesh=t,this.wheels=[],this._physijs={id:n(),rigidBody:t._physijs.id,suspension_stiffness:e.suspension_stiffness,suspension_compression:e.suspension_compression,suspension_damping:e.suspension_damping,max_suspension_travel:e.max_suspension_travel,friction_slip:e.friction_slip,max_suspension_force:e.max_suspension_force}},s.Vehicle.prototype.addWheel=function(t,e,i,s,o,n,r,h,a){var p=new THREE.Mesh(t,e);p.castShadow=p.receiveShadow=!0,p.position.copy(s).multiplyScalar(n/100).add(i),this.world.add(p),this.wheels.push(p),this.world.execute("addWheel",{id:this._physijs.id,connection_point:{x:i.x,y:i.y,z:i.z},wheel_direction:{x:s.x,y:s.y,z:s.z},wheel_axle:{x:o.x,y:o.y,z:o.z},suspension_rest_length:n,wheel_radius:r,is_front_wheel:h,tuning:a})},s.Vehicle.prototype.setSteering=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setSteering",{id:this._physijs.id,wheel:e,steering:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setSteering",{id:this._physijs.id,wheel:i,steering:t})},s.Vehicle.prototype.setBrake=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("setBrake",{id:this._physijs.id,wheel:e,brake:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("setBrake",{id:this._physijs.id,wheel:i,brake:t})},s.Vehicle.prototype.applyEngineForce=function(t,e){if(void 0!==e&&void 0!==this.wheels[e])this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:e,force:t});else if(this.wheels.length>0)for(var i=0;i<this.wheels.length;i++)this.world.execute("applyEngineForce",{id:this._physijs.id,wheel:i,force:t})},s.VehicleTuning=function(t,e,i,s,o,n){this.suspension_stiffness=void 0!==t?t:5.88,this.suspension_compression=void 0!==e?e:.83,this.suspension_damping=void 0!==i?i:.88,this.max_suspension_travel=void 0!==s?s:500,this.friction_slip=void 0!==o?o:10.5,this.max_suspension_force=void 0!==n?n:6e3},s}();